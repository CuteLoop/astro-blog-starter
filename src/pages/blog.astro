---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const posts = (await getCollection("blog", ({ data }) => !data.draft))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<BaseLayout
  pageTitle="Blog"
  description="Posts from the content collection."
>
  <p class="meta">Posts from your content collection.</p>

  {posts.length === 0 ? (
    <p>No posts yet.</p>
  ) : (
    <ul class="post-list">
      {posts.map((p) => (
        <li class="post-item">
          <a class="post-link" href={`/posts/${p.slug}/`}>
            <div class="post-top">
              <span class="post-title">{p.data.title}</span>
              <span class="post-date">{p.data.pubDate.toISOString().slice(0, 10)}</span>
            </div>
            {p.data.description && <p class="post-desc">{p.data.description}</p>}
          </a>
        </li>
      ))}
    </ul>
  )}

  <style>
    .post-list {
      list-style: none;
      padding: 0;
      margin: 1.25rem 0 0;
      display: grid;
      gap: 0.75rem;
    }

    .post-link {
      display: block;
      padding: 0.9rem 1rem;
      border-radius: 0.85rem;
      background: rgba(15, 23, 42, 0.04);
      border: 1px solid rgba(15, 23, 42, 0.08);
      text-decoration: none;
    }

    .post-link:hover,
    .post-link:focus-visible {
      border-color: rgba(96, 165, 250, 0.35);
    }

    .post-top {
      display: flex;
      gap: 1rem;
      justify-content: space-between;
      align-items: baseline;
    }

    .post-title {
      font-weight: 750;
      color: var(--ink);
      text-decoration: underline;
      text-decoration-color: rgba(15, 23, 42, 0.18);
      text-underline-offset: 0.18em;
    }

    .post-date {
      font-size: 0.9rem;
      color: var(--ink-muted);
      white-space: nowrap;
    }

    .post-desc {
      margin: 0.5rem 0 0;
      color: var(--ink-muted);
    }
  </style>
</BaseLayout>
